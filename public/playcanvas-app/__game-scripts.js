var TweenRotation=pc.createScript("tweenRotation");TweenRotation.attributes.add("RotationSpeed",{type:"number"}),TweenRotation.prototype.initialize=function(){},TweenRotation.prototype.update=function(t){var e=this.entity.getLocalEulerAngles().x,n=this.entity.getLocalEulerAngles().y,i=this.entity.getLocalEulerAngles().z-this.RotationSpeed*t;this.entity.setLocalEulerAngles(e,n,i)};var MyEnum={LoadAvatar:1};class ButtonManager extends pc.ScriptType{onButtonClick(){if(1===this.Choices)this.LoadAvatar()}initialize(){this.entity.element.on("mousedown",this.onRelease,this),this.entity.button&&(this.entity.button.on("hoverstart",this.hoverStart,this),this.entity.button.on("hoverend",this.hoverEnd,this)),this.app.touch&&this.entity.element.on("touchend",this.onTouchDown,this)}hoverStart(t){document.body.style.cursor="pointer"}hoverEnd(t){document.body.style.cursor="auto"}onPressedDown(t){this.pointerDown=!0}onMove(t){this.pointerDown=!1}onRelease(t){t.stopPropagation(),this.onButtonClick(),this.pointerDown=!1,this.app.fire("sound:playSound","Btnclick")}onTouchDown(t){this.onButtonClick(),this.pointerDown=!1,this.app.fire("sound:playSound","Btnclick")}LoadAvatar(){this.app.fire("BtnManager:LoadAvatarButtonClick")}}function mapEnum(t){var n={},o=[];for(var e in t)if(t.hasOwnProperty(e)){var i={};i[e]=t[e],o.push(i),n[t[e]]=e}return t.toString=function(t){return n[t]},o}pc.registerScript(ButtonManager,"buttonManager"),ButtonManager.attributes.add("Choices",{type:"number",enum:mapEnum(MyEnum)});var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.prototype.initialize=function(){var e=this.app.root.findByName("Camera TPC");this.cameraScript=e.script.cameraMovement,this.force=new pc.Vec3,this.forceX=new pc.Vec3,this.forceZ=new pc.Vec3,this.app.on("thirdPersonMovementSpeed",this.changePlayerSpeed.bind(this)),this.on("destroy",function(){this.app.off("thirdPersonMovementSpeed")}.bind(this))},PlayerMovement.prototype.changePlayerSpeed=function(){this.speed=this.speed+.02},PlayerMovement.prototype.update=function(e){var t=this.app;this.force=pc.Vec3.ZERO.clone();var i=this.entity.forward,r=this.entity.right;if((t.keyboard.isPressed(pc.KEY_A)||t.keyboard.isPressed(pc.KEY_LEFT))&&(this.force.x-=r.x,this.force.z-=r.z),(t.keyboard.isPressed(pc.KEY_D)||t.keyboard.isPressed(pc.KEY_RIGHT))&&(this.force.x+=r.x,this.force.z+=r.z),(t.keyboard.isPressed(pc.KEY_W)||t.keyboard.isPressed(pc.KEY_UP))&&(this.force.x+=i.x,this.force.z+=i.z),(t.keyboard.isPressed(pc.KEY_S)||t.keyboard.isPressed(pc.KEY_DOWN))&&(this.force.x-=i.x,this.force.z-=i.z),this.forceX.copy(this.entity.right).scale(this.cameraScript.velX*this.speed),this.forceZ.copy(this.entity.forward).scale(-this.cameraScript.velZ*this.speed),this.cameraScript.LTouch&&(this.force=this.forceX.add(this.forceZ).normalize().scale(80)),0!==this.force.x||0!==this.force.z){var s=new pc.Vec3(this.force.x*e,0,this.force.z*e);s.normalize().scale(this.speed),s.add(this.entity.getPosition());var c=this.cameraScript.eulers.x+180,o=new pc.Vec3(0,c,0);this.entity.rigidbody.teleport(s,o)}};var CustomAvatarLoader=pc.createScript("customAvatarLoader");CustomAvatarLoader.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),CustomAvatarLoader.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),CustomAvatarLoader.attributes.add("LoadAvatarBtn",{type:"entity"}),CustomAvatarLoader.attributes.add("LoadingScreen",{type:"entity"}),CustomAvatarLoader.instance=null,window.addEventListener("message",(function(t){"https://rarerooms.readyplayer.me"===t.origin&&CustomAvatarLoader.instance.LoadNewAvatar(t.data)}),!1),CustomAvatarLoader.prototype.initialize=function(){if(CustomAvatarLoader.instance=this,this.GlbURL=null,this.iframeWidth=window.innerWidth,this.iframeHeight=window.innerHeight,this.app.on("BtnManager:LoadAvatarButtonClick",this.customAvatarSelection.bind(this)),this.on("destroy",function(){this.app.off("BtnManager:LoadAvatarButtonClick",this.customAvatarSelection.bind(this))}.bind(this)),this.setupIframe(),this.isMobile=!1,pc.platform.mobile||pc.platform.android||pc.platform.ios){let t=document.getElementById("avatarIframe");t.style.width=this.iframeWidth+"px",t.style.height=this.iframeHeight+"px",t.style.border="none",this.isMobile=!0}else{let t=document.getElementById("avatarIframe");t.style.width="900px",t.style.height="650px",t.style.border="none",this.isMobile=!1}},CustomAvatarLoader.prototype.LoadNewAvatar=function(t){let e=document.getElementById("avatarIframe"),a=document.getElementById("avatarDiv");e.style.display="none",a.style.display="none",this.loadGLBModelFromURL(t)},CustomAvatarLoader.prototype.loadGLBModelFromURL=function(t){this.GlbURL=t,this.app.fire("LoadingMenu:SetLoading",!0,"Loading Avatar..");let e="model_"+Math.floor(1e4*Math.random()),a=t+"?cacheBuster="+Math.floor(1e4*Math.random());this.LoadingScreen.enabled=!0,utils.loadGlbContainerFromUrl(a,null,e,function(t,e){e.resources[0].model?this.app.root.findByName("ModelTPC").model.asset=e.resources[0].model.id:console.log(e.resources),this.LoadAvatarBtn.enabled=!0,this.LoadingScreen.enabled=!1}.bind(this))},CustomAvatarLoader.prototype.setupIframe=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.id="avatarDiv",this.div.classList.add("avatarContrainer"),this.div.innerHTML=this.html.resource||"",this.div.style.display="none";document.getElementById("application-canvas");document.body.appendChild(this.div)},CustomAvatarLoader.prototype.customAvatarSelection=function(){this.LoadAvatarBtn.enabled=!1;let t=document.getElementById("avatarIframe"),e=document.getElementById("avatarDiv");t.src="https://rarerooms.readyplayer.me/avatar",t.style.display="block",e.style.display="block"},CustomAvatarLoader.prototype.update=function(t){};var PlayerAnimationHandler=pc.createScript("playerAnimationHandler");PlayerAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),PlayerAnimationHandler.attributes.add("velMin",{type:"number",default:10}),PlayerAnimationHandler.attributes.add("velMax",{type:"number",default:50}),PlayerAnimationHandler.prototype.initialize=function(){var i=this.app,e=i.root.findByName("Camera TPC");this.cameraScript=e.script.cameraMovement,i.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),i.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.on("destroy",function(){this.app.keyboard.off(pc.EVENT_KEYDOWN),this.app.keyboard.off(pc.EVENT_KEYUP)}.bind(this)),this.direction="Idle",this.setDirection("Idle")},PlayerAnimationHandler.prototype.update=function(i){if(this.cameraScript.LTouch){var e=this.direction;this.checkTouch(),e!==this.direction&&this.setDirection(this.direction)}},PlayerAnimationHandler.prototype.checkButtons=function(){var i=this.app,e=i.keyboard.isPressed(pc.KEY_W)||i.keyboard.isPressed(pc.KEY_UP),t=i.keyboard.isPressed(pc.KEY_A)||i.keyboard.isPressed(pc.KEY_LEFT),a=i.keyboard.isPressed(pc.KEY_S)||i.keyboard.isPressed(pc.KEY_DOWN),r=i.keyboard.isPressed(pc.KEY_D)||i.keyboard.isPressed(pc.KEY_RIGHT);this.direction=e&&!a?"Walking":a&&!e?"WalkBack":t&&!r?"WalkLeft":r&&!t?"WalkRight":"Idle"},PlayerAnimationHandler.prototype.checkTouch=function(){this.app;this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX<-this.velMax||this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX>this.velMax||this.cameraScript.velZ<0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="Walking":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX<-this.velMax||this.cameraScript.velZ>this.velMax&&this.cameraScript.velX>this.velMax||this.cameraScript.velZ>0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="WalkBack":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX<-this.velMin?this.direction="WalkLeft":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX>this.velMin?this.direction="WalkRight":this.direction="Idle"},PlayerAnimationHandler.prototype.keyChange=function(i){var e=this.direction;this.checkButtons(),e!==this.direction&&this.setDirection(this.direction)},PlayerAnimationHandler.prototype.setDirection=function(i){this.direction=i,this.entity.animation.play(i,this.blendTime)};!function(){var e={},r=pc.Application.getApplication();e.loadGlbContainerFromAsset=function(e,r,t,n){var o=new Blob([e.resource]),a=URL.createObjectURL(o);return this.loadGlbContainerFromUrl(a,r,t,(function(e,r){n(e,r),URL.revokeObjectURL(a)}))},e.loadGlbContainerFromUrl=function(e,t,n,o){var a=n+".glb",l={url:e,filename:a},s=new pc.Asset(a,"container",l,null,t);return s.tags.add(a),s.once("load",(function(e){if(o){var r=e.resource.animations;if(1==r.length)r[0].name=n;else if(r.length>1)for(var t=0;t<r.length;++t)r[t].name=n+" "+t.toString();for(let r=0;r<e.resource.materials.length;r++)e.resource.materials[r].tags.add(a);for(let r=0;r<e.resource.textures.length;r++)e.resource.textures[r].tags.add(a);o(null,e)}})),r.assets.add(s),r.assets.load(s),s},e.wrapAngle360=function(e){return e%360},e.cloneTexture=function(e){var r=new pc.Texture(e.device,e);return r._levels=function(e){for(var r=[],t=0;t<e._levels.length;++t){var n=[];if(e.cubemap)for(var o=0;o<6;++o)n.push(e._levels[t][o]);else n=e._levels[t];r.push(n)}return r}(e),r},e.cloneTextureAsset=function(r){var t=new pc.Asset(r.name,r.type,r.file,r.data,r.options);return t.loaded=!0,t.resource=e.cloneTexture(r.resource),r.registry.add(t),t},window.utils=e}();var Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Ui.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div)};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.attributes.add("touchSensitivity",{type:"number",default:5,description:"Touch Sensitivity"});const isDebug=!1;CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var t=this.app;t.mouse.on("mousemove",this.onMouseMove,this);t.graphicsDevice.canvas;this.isMouseDown=!1,this.app.mouse.on("mousedown",(function(){this.isMouseDown=!0}),this),this.app.mouse.on("mouseup",(function(){this.isMouseDown=!1}),this),this.lastLTouchPoint=new pc.Vec2,this.LTouchStartPoint=new pc.Vec2,this.LTouch=null,this.Rid=-1,this.Lid=-1,this.velZ=0,this.velX=0,this.rayEnd=t.root.findByName("RaycastEndPoint TPC"),t.touch&&(t.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),t.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.on("destroy",function(){this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART),this.app.touch.off(pc.EVENT_TOUCHEND),this.app.touch.off(pc.EVENT_TOUCHCANCEL),this.app.touch.off(pc.EVENT_TOUCHMOVE)),this.app.mouse.off("mousedown"),this.app.mouse.off("mousemove"),"onpointerlockchange"in document?document.removeEventListener("pointerlockchange",lockChangeAlert,!1):"onmozpointerlockchange"in document&&document.removeEventListener("mozpointerlockchange",lockChangeAlert,!1)}.bind(this))},CameraMovement.prototype.update=function(t){this.velZ=-1!=this.Lid?this.lastLTouchPoint.y-this.LTouchStartPoint.y:0,this.velX=-1!=this.Lid?this.lastLTouchPoint.x-this.LTouchStartPoint.x:0},CameraMovement.prototype.postUpdate=function(t){var i=this.entity.parent,o=this.eulers.x+180,e=this.eulers.y,s=new pc.Vec3(-e,o,0);i.setEulerAngles(s),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(i.getPosition())},CameraMovement.prototype.onMouseMove=function(t){this.isMouseDown&&(this.eulers.x-=this.mouseSpeed*t.dx/60%360,this.eulers.y=Math.max(Math.min(this.eulers.y+this.mouseSpeed*t.dy/60%360,89.99),-89.99))},CameraMovement.prototype.onTouchStart=function(t){t.changedTouches.forEach((function(t){var i=this.app.graphicsDevice;t.x>.5*i.width/window.devicePixelRatio&&-1==this.Rid&&(this.Rid=t.id,this.touchCoords.set(t.x,t.y)),t.x<=.5*i.width/window.devicePixelRatio&&-1==this.Lid&&(this.Lid=t.id,this.LTouchStartPoint.set(t.x,t.y),this.lastLTouchPoint.set(t.x,t.y))}),this)},CameraMovement.prototype.onTouchEnd=function(t){t.changedTouches.forEach((function(t){this.Rid==t.id&&(this.Rid=-1),this.Lid==t.id&&(this.Lid=-1)}),this)},CameraMovement.prototype.onTouchMove=function(t){if(this.RTouch=t.getTouchById(this.Rid,t.touches),this.LTouch=t.getTouchById(this.Lid,t.touches),this.RTouch){var i=(this.RTouch.x-this.touchCoords.x)*this.touchSensitivity,o=(this.RTouch.y-this.touchCoords.y)*this.touchSensitivity;this.eulers.x-=this.touchSensitivity*i/60%360,this.eulers.y+=this.touchSensitivity*o/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360),this.touchCoords.set(this.RTouch.x,this.RTouch.y)}this.LTouch&&this.lastLTouchPoint.set(this.LTouch.x,this.LTouch.y)},CameraMovement.prototype.getWorldPoint=function(){var t=this.entity.parent.getPosition(),i=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(t,i);return o?o.point:i};